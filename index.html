<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PerfectAPIClient  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="PerfectAPIClient  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">PerfectAPIClient Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/SvenTiigi/PerfectAPIClient"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">PerfectAPIClient Reference</a>
        <img id="carat" src="img/carat.png" />
        PerfectAPIClient  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/APIClientEnvironment.html">APIClientEnvironment</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/APIClientEnvironmentMode.html">APIClientEnvironmentMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/APIClientError.html">APIClientError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/APIClientResult.html">APIClientResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/APIClient.html">APIClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/JSONCustomStringConvertible.html">JSONCustomStringConvertible</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/APIClientRequest.html">APIClientRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/APIClientResponse.html">APIClientResponse</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p align="center"><img src="https://raw.githubusercontent.com/SvenTiigi/PerfectAPIClient/gh-pages/img/logo.png" width="60%"></p>

<p align="center">
    <a href="https://developer.apple.com/swift/" target="_blank">
        <img src="https://img.shields.io/badge/Swift-4.0-orange.svg" alt="Swift 3.2">
    </a>
    <img src="https://img.shields.io/badge/platform-macOS%20%7C%20Linux-yellow.svg" alt="Platform">
    <a href="https://travis-ci.org/SvenTiigi/PerfectAPIClient" target="_blank">
        <img src="https://travis-ci.org/SvenTiigi/PerfectAPIClient.svg?branch=master" alt="TravisBuild">
    </a>
    <a href="https://codecov.io/gh/SvenTiigi/PerfectAPIClient" target="_blank">
        <img src="https://img.shields.io/codecov/c/github/SvenTiigi/PerfectAPIClient.svg" alt="Coverage">
    </a>
    <a href="https://codebeat.co/projects/github-com-sventiigi-perfectapiclient-master">
        <img alt="codebeat badge" src="https://codebeat.co/badges/85818a0c-1056-4f28-8348-f61ead493c81" />
    </a>
    <a href="https://sventiigi.github.io/PerfectAPIClient" target="_blank">
        <img src="https://github.com/SvenTiigi/PerfectAPIClient/blob/gh-pages/badge.svg" alt="Docs">
    </a>
    <a href="https://twitter.com/SvenTiigi" target="_blank">
        <img src="https://img.shields.io/badge/contact-@SvenTiigi-blue.svg" alt="@SvenTiigi">
    </a>
</p>

<p>PerfectAPIClient is a network abstraction layer to perform network requests via <a href="https://github.com/PerfectlySoft/Perfect-CURL">Perfect-CURL</a> from your <a href="https://github.com/PerfectlySoft/Perfect">Perfect Server Side Swift</a> application. It&rsquo;s heavily inspired by <a href="https://github.com/Moya/Moya">Moya</a> and it&rsquo;s easy and fun to use.</p>

<p align="center"><img src="https://raw.githubusercontent.com/SvenTiigi/PerfectAPIClient/gh-pages/img/diagram.png" width="40%"></p>
<h1 id='installation' class='heading'>Installation</h1>

<p>To integrate using Apple&rsquo;s <a href="https://swift.org/package-manager/">Swift Package Manager</a>, add the following as a dependency to your <code>Package.swift</code>:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/SvenTiigi/PerfectAPIClient.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">)</span>
</code></pre>

<p>Here&rsquo;s an example <code>PackageDescription</code>:</p>
<pre class="highlight swift"><code><span class="c1">// swift-tools-version:4.0</span>

<span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="nf">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"MyPackage"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"MyPackage"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"MyPackage"</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/SvenTiigi/PerfectAPIClient.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"MyPackage"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"PerfectAPIClient"</span><span class="p">]</span>
        <span class="p">),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"MyPackageTests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"MyPackage"</span><span class="p">,</span> <span class="s">"PerfectAPIClient"</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<h1 id='setup' class='heading'>Setup</h1>

<p>In order to define the network abstraction layer with PerfectAPIClient, an enumeration will be declared to access the API endpoints. In this example we declare a <a href="https://github.com/SvenTiigi/PerfectAPIClient/blob/master/Tests/PerfectAPIClientTests/GithubAPI/GithubAPIClient.swift">GithubAPIClient</a> to retrieve some Github <a href="https://api.github.com/zen">zen</a> and <a href="https://api.github.com/users/sventiigi">user information</a>.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">PerfectAPIClient</span>
<span class="kd">import</span> <span class="kt">PerfectHTTP</span>
<span class="kd">import</span> <span class="kt">PerfectCURL</span>
<span class="kd">import</span> <span class="kt">ObjectMapper</span>

<span class="c1">/// Github API Client in order to access Github API Endpoints</span>
<span class="kd">enum</span> <span class="nf">GithubAPIClient</span> <span class="p">{</span>
    <span class="c1">/// Retrieve zen</span>
    <span class="k">case</span> <span class="n">zen</span>
    <span class="c1">/// Retrieve user info for given username</span>
    <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="c1">/// Retrieve repositories for user name</span>
    <span class="k">case</span> <span class="nf">repositories</span><span class="p">(</span><span class="nv">userName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Next up we implement the <code><a href="Protocols/APIClient.html">APIClient</a></code> protocol to define the request information like base url, endpoint path, HTTP header, etc&hellip;</p>
<pre class="highlight swift"><code><span class="c1">// MARK: APIClient</span>

<span class="kd">extension</span> <span class="kt">GithubAPIClient</span><span class="p">:</span> <span class="nf">APIClient</span> <span class="p">{</span>

    <span class="c1">/// The base url</span>
    <span class="k">var</span> <span class="nv">baseURL</span><span class="p">:</span> <span class="nf">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://api.github.com/"</span>
    <span class="p">}</span>

    <span class="c1">/// The path for a specific endpoint</span>
    <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="nf">String</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nf">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">zen</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"zen"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="k">let</span> <span class="nv">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">"users/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">repositories</span><span class="p">(</span><span class="nv">userName</span><span class="p">:</span> <span class="k">let</span> <span class="nv">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">"users/</span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">/repos"</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// The http method</span>
    <span class="k">var</span> <span class="nv">method</span><span class="p">:</span> <span class="nf">HTTPMethod</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nf">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">zen</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="k">get</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="k">get</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">repositories</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="k">get</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// The HTTP headers</span>
    <span class="k">var</span> <span class="nv">headers</span><span class="p">:</span> <span class="p">[</span><span class="kt">HTTPRequestHeader</span><span class="o">.</span><span class="kt">Name</span><span class="p">:</span> <span class="kt">String</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="o">.</span><span class="nv">userAgent</span><span class="p">:</span> <span class="s">"PerfectAPIClient"</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1">/// The request payload for a POST or PUT request</span>
    <span class="k">var</span> <span class="nv">requestPayload</span><span class="p">:</span> <span class="nf">BaseMappable</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="c1">/// Advanced CURLRequest options like SSL or Proxy settings</span>
    <span class="k">var</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">CURLRequest</span><span class="o">.</span><span class="kt">Option</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="c1">/// The mock response result for unit tests</span>
    <span class="k">var</span> <span class="nv">mockResponseResult</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">APIClientResponse</span><span class="o">&gt;</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="nf">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">zen</span><span class="p">:</span>
            <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="nf">APIClientRequest</span><span class="p">(</span><span class="nv">apiClient</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="nf">APIClientResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">getRequestURL</span><span class="p">(),</span> <span class="nv">status</span><span class="p">:</span> <span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="nv">payload</span><span class="p">:</span> <span class="s">"Some zen for you my friend"</span><span class="p">,</span> <span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>

<p>There is also an <a href="https://github.com/SvenTiigi/PerfectAPIClient/blob/master/Tests/PerfectAPIClientTests/JSONPlaceholderAPI/JSONPlaceholderAPI.swift">JSONPlaceholderAPIClient</a> example available.</p>
<h1 id='usage' class='heading'>Usage</h1>

<p>PerfectAPIClient enables an easy way to access an API like this:</p>
<pre class="highlight swift"><code><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="n">zen</span><span class="o">.</span><span class="nf">request</span> <span class="p">{</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">APIClientResponse</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
    <span class="n">result</span><span class="o">.</span><span class="nf">analysis</span><span class="p">(</span><span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">APIClientResponse</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Do awesome stuff with the response</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="c1">// The request url</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span> <span class="c1">// The response HTTP status</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span> <span class="c1">// The response payload</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="nf">getHTTPHeader</span><span class="p">(</span><span class="nv">field</span><span class="p">:</span> <span class="s">"Content-Type"</span><span class="p">))</span> <span class="c1">// HTTP header field</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getPayloadJSON</span><span class="p">)</span> <span class="c1">// The payload as JSON/Dictionary</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="nf">getMappablePayload</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">SomethingMappable</span><span class="o">.</span><span class="k">self</span><span class="p">))</span> <span class="c1">// Map payload into an object</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="nf">getMappablePayloadArray</span><span class="p">(</span><span class="kt">SomethingMappable</span><span class="o">.</span><span class="k">self</span><span class="p">))</span> <span class="c1">// JSON Array</span>
    <span class="p">},</span> <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">APIClientError</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Oh boy you are in trouble 😨</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Or even retrieve an <code>JSON</code> response as an automatically <code>Mappable</code> object.</p>
<pre class="highlight swift"><code><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"sventiigi"</span><span class="p">)</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="nv">mappable</span><span class="p">:</span> <span class="kt">User</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
    <span class="n">result</span><span class="o">.</span><span class="nf">analysis</span><span class="p">(</span><span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Do awesome stuff with the user</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1">// Sven Tiigi</span>
    <span class="p">},</span> <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">APIClientError</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Oh boy you are in trouble again 😱</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>If your response contains an <code>JSON Array</code>:</p>
<pre class="highlight swift"><code><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="nf">repositories</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="s">"sventiigi"</span><span class="p">)</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="nv">mappable</span><span class="p">:</span> <span class="kt">Repository</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repository</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
    <span class="n">result</span><span class="o">.</span><span class="nf">analysis</span><span class="p">(</span><span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="p">[</span><span class="kt">Repository</span><span class="p">])</span> <span class="k">in</span>
        <span class="c1">// Do awesome stuff with the repositories</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">repositories</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
    <span class="p">},</span> <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">APIClientError</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// 🙈</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The user object in this example implements the <code>Mappable</code> protocol based on the <a href="https://github.com/Hearst-DD/ObjectMapper">ObjectMapper</a> library to perform the mapping between the struct/class and <code>JSON</code>.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">ObjectMapper</span>

<span class="kd">struct</span> <span class="nf">User</span> <span class="p">{</span>
    <span class="c1">/// The users full name</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="c1">/// The user type</span>
    <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="c1">// MARK: Mappable</span>

<span class="kd">extension</span> <span class="kt">User</span><span class="p">:</span> <span class="nf">Mappable</span> <span class="p">{</span>
    <span class="c1">/// ObjectMapper initializer</span>
    <span class="nf">init</span><span class="p">?(</span><span class="nv">map</span><span class="p">:</span> <span class="kt">Map</span><span class="p">)</span> <span class="p">{}</span>

    <span class="c1">/// Mapping</span>
    <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">mapping</span><span class="p">(</span><span class="nv">map</span><span class="p">:</span> <span class="kt">Map</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span>   <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="k">self</span><span class="o">.</span><span class="n">type</span>   <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h1 id='error-handling' class='heading'>Error Handling</h1>

<p>When you perform the <code>analysis</code> function on the <code><a href="Enums/APIClientResult.html">APIClientResult</a></code> or you do a simple <code>switch</code> or <code>if case</code> on the <code><a href="Enums/APIClientResult.html">APIClientResult</a></code> you will retrieve an <code><a href="Enums/APIClientError.html">APIClientError</a></code> via the <code>failure</code> case if an error occured. The following example shows what types of error cases are available on the <code><a href="Enums/APIClientError.html">APIClientError</a></code>.</p>
<pre class="highlight swift"><code><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="n">zen</span><span class="o">.</span><span class="nf">request</span> <span class="p">{</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">APIClientResponse</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
    <span class="n">result</span><span class="o">.</span><span class="nf">analysis</span><span class="p">(</span><span class="nv">success</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">APIClientResponse</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Do awesome stuff with the response</span>
    <span class="p">},</span> <span class="nv">failure</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">APIClientError</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Oh boy you are in trouble 😨</span>
    <span class="c1">// Analysis the APIClientError</span>
        <span class="n">error</span><span class="o">.</span><span class="nf">analysis</span><span class="p">(</span><span class="nv">mappingFailed</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">APIClientResponse</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// Mapping failed</span>
        <span class="p">},</span> <span class="nv">badResponseStatus</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">APIClientResponse</span><span class="p">)</span> <span class="k">in</span>
            <span class="c1">// Bad response status</span>
        <span class="p">},</span> <span class="nv">connectionFailed</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">,</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">APIClientRequest</span><span class="p">)</span> <span class="k">in</span>
            <span class="c1">// Connection failure</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><code>MappingFailed</code>: Indicates that the Mapping between your <code>mappable</code> type and the response <code>JSON</code> doesn&rsquo;t match.</li>
<li><code>BadResponseStatus</code>: Indicates that the <code><a href="Protocols/APIClient.html">APIClient</a></code> has received a bad response status <code>&gt;= 300</code> or <code>&lt; 200</code></li>
<li><code>ConnectionFailed</code>: Indicates that an error occurred during the CURL request to the given url.</li>
</ul>

<p>The <code>analysis</code> function on the <code><a href="Enums/APIClientError.html">APIClientError</a></code> is just a convenience way to check which error type has been retrieved. Of course you can perform a <code>switch</code> or an <code>if case</code> on the <code><a href="Enums/APIClientError.html">APIClientError</a></code> enumeration.</p>
<h1 id='advanced-usage' class='heading'>Advanced Usage</h1>
<h3 id='modify-request-url' class='heading'>Modify Request URL</h3>

<p>By overriding the <code>modify(requestURL ...)</code> function you can update the constructed request URL from baseURL and path. It&rsquo;s handy when you want to add a <code>Token</code> query parameter to your request url everytime instead of adding it to every path.</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">modify</span><span class="p">(</span><span class="nv">requestURL</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">requestURL</span> <span class="o">+=</span> <span class="s">"?token=42"</span>
<span class="p">}</span>
</code></pre>
<h3 id='modify-json-before-mapping' class='heading'>Modify JSON before Mapping</h3>

<p>By overriding the <code>modify(responseJSON ...)</code> function you can update the response JSON before it&rsquo;s being mapped from JSON to your mappable type. It&rsquo;s handy when the response JSON is wrapped inside a <code>result</code> property.</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">modify</span><span class="p">(</span><span class="nv">responseJSON</span><span class="p">:</span> <span class="k">inout</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span> <span class="nv">mappable</span><span class="p">:</span> <span class="kt">BaseMappable</span><span class="o">.</span><span class="k">Type</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Try to retrieve JSON from result property</span>
    <span class="n">responseJSON</span> <span class="o">=</span> <span class="n">responseJSON</span><span class="p">[</span><span class="s">"result"</span><span class="p">]</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">??</span> <span class="n">responseJSON</span>
<span class="p">}</span>
</code></pre>
<h3 id='modify-json-array-before-mapping' class='heading'>Modify JSON Array before Mapping</h3>

<p>By overriding the <code>modify(responseJSONArray ...)</code> function you can update the response JSON Array before it&rsquo;s being mapped to an mappable array.</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">modify</span><span class="p">(</span><span class="nv">responseJSONArray</span><span class="p">:</span> <span class="k">inout</span> <span class="p">[[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]],</span> <span class="nv">mappable</span><span class="p">:</span> <span class="kt">BaseMappable</span><span class="o">.</span><span class="k">Type</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Manipulate the responseJSONArray if you need so</span>
<span class="p">}</span>
</code></pre>
<h3 id='should-fail-on-bad-response-status' class='heading'>Should fail on bad response status</h3>

<p>By overriding the <code>shouldFailOnBadResponseStatus()</code> function you can decide if the <code><a href="Protocols/APIClient.html">APIClient</a></code> should evaluate the result as a failure if the response status code is<code>&gt;= 300</code> or <code>&lt; 200</code>. The default implementation returns <code>true</code> which results that an response with an bad response status code will lead to an <code><a href="Enums/APIClientResult.html">APIClientResult</a></code> of type <code>failure</code>.</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">shouldFailOnBadResponseStatus</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nf">Bool</span> <span class="p">{</span>
    <span class="c1">// Default implementation</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre>
<h1 id='logging' class='heading'>Logging</h1>

<p>By overrding the following two functions you can add logging to your request before the request started and when a response is retrieved or something else you might want to do.</p>
<h3 id='will-perform-request' class='heading'>Will Perform Request</h3>

<p>By overriding the <code>willPerformRequest</code> function you can perform logging operation or something else your might want to do, before the request of an <code><a href="Protocols/APIClient.html">APIClient</a></code> will be executed.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">willPerformRequest</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">APIClientRequest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Will perform request </span><span class="se">\(</span><span class="n">request</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h3 id='did-retrieve-response' class='heading'>Did Retrieve Response</h3>

<p>By overriding the <code>didRetrieveResponse</code> function you can perform logging operation or something else your might want to do, after the response of an request for an <code><a href="Protocols/APIClient.html">APIClient</a></code> is being retrieved.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">didRetrieveResponse</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">APIClientRequest</span><span class="p">,</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">APIClientResponse</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Did retrieve response for request: </span><span class="se">\(</span><span class="n">request</span><span class="se">)</span><span class="s"> and result: </span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h1 id='mocking' class='heading'>Mocking</h1>

<p>In order to define that your <code><a href="Protocols/APIClient.html">APIClient</a></code> is under <code>Unit</code> or <code>Integration</code> Tests condition, you need to update the <code><a href="Enums/APIClientEnvironmentMode.html">APIClientEnvironmentMode</a></code>. The recommended way is to override <code>setUp</code> and <code>tearDown</code> and update the <code><a href="Enums/APIClientEnvironmentMode.html">APIClientEnvironmentMode</a></code> as seen in the following example.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">XCTest</span>
<span class="kd">import</span> <span class="kt">PerfectAPIClient</span>

<span class="kd">class</span> <span class="kt">MyAPIClientTestClass</span><span class="p">:</span> <span class="nf">XCTestCase</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">setUp</span><span class="p">()</span>
        <span class="c1">// Enable Test Environment Mode</span>
        <span class="c1">// MockResponseResult is used if available</span>
        <span class="kt">APIClientEnvironment</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="o">.</span><span class="n">test</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tearDown</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">tearDown</span><span class="p">()</span>
        <span class="c1">// Reset to Standard Environment Mode</span>
        <span class="kt">APIClientEnvironment</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="o">.</span><span class="n">standard</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">testMyAPIClient</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Your test logic</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<h3 id='mockresponseresult' class='heading'>MockResponseResult</h3>

<p>In order to add mocking to your APIClient for unit testing your application you can return an <code><a href="Enums/APIClientResult.html">APIClientResult</a></code> via the <code>mockResponseResult</code> protocol variable. The <code>mockResponseResult</code> is only used when you return an <code><a href="Enums/APIClientResult.html">APIClientResult</a></code> and the current runtime is under unit test conditions.</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">mockResponseResult</span><span class="p">:</span> <span class="kt">APIClientResult</span><span class="o">&lt;</span><span class="kt">APIClientResponse</span><span class="o">&gt;</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="nf">self</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">zen</span><span class="p">:</span>
        <span class="c1">// This result will be used when unit tests are running</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="nf">APIClientRequest</span><span class="p">(</span><span class="nv">apiClient</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="nf">APIClientResponse</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="nf">getRequestURL</span><span class="p">(),</span> <span class="nv">status</span><span class="p">:</span> <span class="o">.</span><span class="n">ok</span><span class="p">,</span> <span class="nv">payload</span><span class="p">:</span> <span class="s">"Keep it logically awesome."</span><span class="p">,</span> <span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">user</span><span class="p">:</span>
        <span class="c1">// A real network request will be performed when unit tests are running</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For more details checkout the <a href="https://github.com/SvenTiigi/PerfectAPIClient/blob/master/Tests/PerfectAPIClientTests/PerfectAPIClientTests.swift">PerfectAPIClientTests.swift</a> file.</p>
<h1 id='slashes' class='heading'>Slashes</h1>

<p>When your ask yourself where to put the slash <code>/</code> when returning a String for <code>baseURL</code> and <code>path</code> 🤔</p>

<p>This is the recommended way ☝️:</p>
<pre class="highlight swift"><code><span class="c1">/// The base url</span>
<span class="k">var</span> <span class="nv">baseURL</span><span class="p">:</span> <span class="nf">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"https://api.awesome.com/"</span>
<span class="p">}</span>

<span class="c1">/// The path for a specific endpoint</span>
<span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="nf">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"users"</span>
<span class="p">}</span>
</code></pre>

<p>Put a slash at the end of your <code>baseURL</code> and skip the slash at the beginning of your <code>path</code>. But don&rsquo;t worry <code><a href="Protocols/APIClient.html">APIClient</a></code> has a default implementation for the <code>getRequestURL()</code> function which add a slash to the <code>baseURL</code> if you forgot it and remove the first character of your <code>path</code> if it&rsquo;s a slash. If you want to change the behavior just override the function 👌</p>
<h1 id='rawrepresentable' class='heading'>RawRepresentable</h1>

<p>As most of your enumeration cases will be mixed with <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Enumerations.html#//apple_ref/doc/uid/TP40014097-CH12-ID148">Associated Values</a> and some without, it&rsquo;s hard to retrieve the enumerations name as a String because you can&rsquo;t declare an Enumeration with associated values like this: </p>
<pre class="highlight swift"><code><span class="c1">// ❌ Error: enum with raw type cannot have cases with arguments</span>
<span class="kd">enum</span> <span class="kt">GithubAPIClient</span><span class="p">:</span> <span class="nf">String</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">zen</span>
    <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>So here is an example to retrieve the enumeration name via the <code>rawValue</code> property from the <code>RawRepresentable</code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="nf">GithubAPIClient</span> <span class="p">{</span>
    <span class="c1">// Without associated value</span>
    <span class="k">case</span> <span class="n">zen</span>
    <span class="c1">// With associated value</span>
    <span class="k">case</span> <span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">GithubAPIClient</span><span class="p">:</span> <span class="nf">RawRepresentable</span> <span class="p">{</span>

    <span class="c1">/// Associated type RawValue as String</span>
    <span class="kd">typealias</span> <span class="kt">RawValue</span> <span class="o">=</span> <span class="kt">String</span>

    <span class="c1">/// RawRepresentable initializer. Which always returns nil</span>
    <span class="c1">///</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///   - rawValue: The rawValue</span>
    <span class="nf">init</span><span class="p">?(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Returning nil to avoid constructing enum with String</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>

    <span class="c1">/// The enumeration name as String</span>
    <span class="k">var</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="nf">RawValue</span> <span class="p">{</span>
        <span class="c1">// Retrieve label via Mirror for Enum with associcated value</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">label</span> <span class="o">=</span> <span class="nf">Mirror</span><span class="p">(</span><span class="nv">reflecting</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">first</span><span class="p">?</span><span class="o">.</span><span class="n">label</span> <span class="nf">else</span> <span class="p">{</span>
            <span class="c1">// Return String describing self enumeration with no asscoiated value</span>
            <span class="k">return</span> <span class="nf">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// Return label</span>
        <span class="k">return</span> <span class="n">label</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>

<p>Full example <a href="https://github.com/SvenTiigi/PerfectAPIClient/blob/master/Tests/PerfectAPIClientTests/GithubAPI/GithubAPIClient.swift">GithubAPIClient.swift</a></p>
<h3 id='usage' class='heading'>Usage</h3>
<pre class="highlight swift"><code><span class="nf">print</span><span class="p">(</span><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="n">zen</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span> <span class="c1">// zen</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">GithubAPIClient</span><span class="o">.</span><span class="nf">user</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"sventiigi"</span><span class="p">)</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span> <span class="c1">// user</span>
</code></pre>

<p>Awesome 😎</p>
<h1 id='linux-build-notes' class='heading'>Linux Build Notes</h1>

<p>Ensure that you have installed <code>libcurl</code>.</p>
<pre class="highlight plaintext"><code>sudo apt-get install libcurl4-openssl-dev
</code></pre>

<p>If you run into problems with <code>JSON-Mapping</code> on <code>Int</code> and <code>Double</code> values using the <a href="https://github.com/Hearst-DD/ObjectMapper">ObjectMapper</a> library under Linux, please see this <a href="https://github.com/Hearst-DD/ObjectMapper/issues/884">issue</a>.</p>
<h1 id='dependencies' class='heading'>Dependencies</h1>

<p>PerfectAPIClient is using the following dependencies:</p>

<ul>
<li><a href="https://github.com/PerfectlySoft/Perfect-HTTP">Perfect-HTTP</a></li>
<li><a href="https://github.com/PerfectlySoft/Perfect-CURL">Perfect-CURL</a></li>
<li><a href="https://github.com/Hearst-DD/ObjectMapper">ObjectMapper</a></li>
</ul>
<h1 id='contributing' class='heading'>Contributing</h1>

<p>Contributions are very welcome 🙌 🤓</p>
<h1 id='to-do' class='heading'>To-Do</h1>

<ul>
<li>[ ] Improve Unit-Tests</li>
<li>[ ] Improve Linux compatibility</li>
<li>[ ] Add automated Jazzy documentation generation via Travis CI</li>
</ul>
<h1 id='license' class='heading'>License</h1>
<pre class="highlight plaintext"><code>MIT License

Copyright (c) 2017 Sven Tiigi

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>Copyright 2017 Sven Tiigi</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
